var parentFolderId = "#folder_" + "<%= @parent_folder.try(:id) ? @parent_folder.id : '' %>"
var folderId = "#folder_" + "<%= @folder.id %>"
var layer = parseInt(document.getElementsByTagName('body')[0].dataset.layer)
console.log(document.getElementsByTagName('body')[0].dataset.layer)
console.log(layer)

<% if @folder.same_window %>
  $('.folderContent' + parentFolderId).replaceWith('<%= j render partial: "#{ @folder.partial_name }" %>')
  $('.mycomputer .menuTop').append('<%= j render partial: "back", folder: @parent_folder %>')
  $('.taskbarItems' + parentFolderId).replaceWith('<%= j render "task_bar_folder" %>')
  $('.taskbarItems' + folderId).append('<%= @folder.name %>')
  $('.folderContent' + folderId).css("z-index", layer)
  document.getElementsByTagName('body')[0].dataset.layer = layer + 1
  <% elsif %>
  if ($('.folderContent' + folderId).length == 0) {
    $('body').append('<%= j render partial: "#{ @folder.partial_name }" %>')
    $('.taskbarElements').append('<%= j render "task_bar_folder" %>')
    $('.taskbarItems' + folderId).append('<%= @folder.name %>')
    $('.folderContent' + folderId).css("z-index",layer)
    document.getElementsByTagName('body')[0].dataset.layer = layer + 1
  }
<% end %>

$('.folderContent' + folderId).on("click", function() {
  $(this).css("z-index", layer)
    console.log('ff');
    document.getElementsByTagName('body')[0].dataset.layer = layer + 1
})

<% if @folder.partial_name === 'matrix'  %>
    $('#Desktop').append('<%= j render partial: "spams/spam" %>')
<% end %>


$(".draggable").draggable({
  zIndex: layer,
  stop: function() {
    document.getElementsByTagName('body')[0].dataset.layer = layer + 1
    $('.folderContent' + folderId).css("z-index", "1", document.getElementsByTagName('body')[0].dataset.layer)
  }
})

$(".contentInside .computerFolders").draggable({
  containment: ".contentInside",
})

//close
$('.closeBtn').on('click', function() {
  var id = $(this).parents('.folderContent').attr("id")
  $('.folderContent#' + id).remove()
  $('.taskbarItems#' + id).remove()
  $(this).parents('.spamWindow').remove()
})

//nodata
$('#unknown').on('click', function() {
  $('.nodata').remove('hidden')
  $('.nodata').css('display', 'flex')
  $('.re').on('click', function() {
    console.log('jh');
    location.reload(true)
  })
})

//turning off

$('.shutDown').on('click', function() {
  console.log('hhh');
  $('#body').addClass('.screen')
  .to(SELECTOR_SCREEN_ELEMENT, .2, {
      width: '100vw',
      height: '2px',
      background: '#ffffff',
      ease: Power2.easeOut
    })
})

  //   .to('.body', .2, {
  //     width: '100vw',
  //     height: '2px',
  //     background: '#ffffff',
  //     ease: Power2.easeOut
  //   })
  //   .to('.body', .2, {
  //     width: '0',
  //     height: '0',
  //     background: '#ffffff'
  //   });
  // }


  // Bindings
  // $('.shutDown').on('click', function() {
  //   toggleSwitcherTV();
  // })


//spam
var spamLinks = document.querySelectorAll('[href="#spam"]'),
    spamWindows = document.querySelectorAll('.spamWindow'),
    spamContainer = document.querySelector('.spam');
var i;
var delay = 300,
  called = false;

$('.searchButton').on('click', function() {
  console.log();
  for (i = 0; i < spamWindows.length; i++) {
    var time = delay * i;
    delayWindowOpen(spamWindows[i], time);
  }
  $('.spam').removeClass('hidden');
})

  function delayWindowOpen(el, time) {
    console.log(i);
    setTimeout(function() {
      el.classList.remove('hidden');
    }, time)
  }

spamContainer.addEventListener('click', function() {
  if (spamContainer.querySelector('.hidden')) {
    called = false;
    for (i = 0; i < spamWindows.length; i++) {
      spamWindows[i].classList.remove('.hidden');
    }
  }
})

var mousetimeout;
var screensaver_active = false;
var idletime = 5;

function show_screensaver(){
    $('#screensaver').fadeIn();
    screensaver_active = true;
    screensaver_animation();
}

function stop_screensaver(){
    $('#screensaver').fadeOut();
    screensaver_active = false;
}

function getRandomColor() {
    var letters = '0123456789ABCDEF'.split('');
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.round(Math.random() * 15)];
    }
    return color;
}

$(document).mousemove(function(){
    clearTimeout(mousetimeout);

    if (screensaver_active) {
        stop_screensaver();
    }

    mousetimeout = setTimeout(function(){
        show_screensaver();
    }, 1000 * idletime); // 5 secs
});

function screensaver_animation(){
    if (screensaver_active) {
        $('#screensaver').animate(
            {backgroundColor: getRandomColor()},
            400,
            screensaver_animation);
    }
}
